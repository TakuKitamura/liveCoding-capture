#!/usr/bin/env oh

define line-count-file: "/"::join (... doctest) 020-generated-readme.oh
define go-gloc: integer @`(find . -name 'generated.go' |
xargs cat | wc -l | sed -e 's/^[ 	]*//')
define oh-gloc: integer @`(find . -name 'generate.oh' |
    grep -v '/bin/' | xargs cat | wc -l | sed -e 's/^[ 	]*//')
define oh-loc: integer @`(find . -name 'boot.oh' |
xargs cat | wc -l | sed -e 's/^[ 	]*//')
define total-loc: add $oh-loc: integer @`(find . -name '*.go' |
    sed -e 's/grammar.go/grammar.y/g' |
    grep -Ev 'generated' | xargs cat | wc -l | sed -e 's/^[ 	]*//')

rm $line-count-file
block {
    echo "#!/usr/bin/env oh"
    echo 
    echo '## <br><a name="f1">1</a>. [^](#r1) Currently, '
    echo "## ${oh-loc} of ${total-loc} lines of code are written in oh with an"
    echo "## additional ${go-gloc} lines of Go generated by ${oh-gloc} lines"
    echo "## of oh."
    echo "##"
} > $line-count-file
chmod 755 $line-count-file

